#!/bin/bash

# Set the PostgreSQL container name
CONTAINER_NAME="postgres-container"

# Set the PostgreSQL port to forward
LOCAL_PORT=5432

# Set the PostgreSQL username and password
POSTGRES_USER="postgres"
POSTGRES_PASSWORD="postgres"

# Set the path to your PostgreSQL backup file
BACKUP_FILE_PATH="docker_db.sql"

# Run the PostgreSQL container
docker run -d --name $CONTAINER_NAME -e POSTGRES_USER=$POSTGRES_USER -e POSTGRES_PASSWORD=$POSTGRES_PASSWORD -p $LOCAL_PORT:5432 postgres

# Display container information
echo "PostgreSQL container '$CONTAINER_NAME' is running."
echo "Local port $LOCAL_PORT is forwarded to PostgreSQL container port 5432."
echo "Username: $POSTGRES_USER"
echo "Password: $POSTGRES_PASSWORD"

# Wait for the PostgreSQL container to be ready
echo "Waiting for PostgreSQL to start..."
until docker exec $CONTAINER_NAME pg_isready; do
    sleep 1
done

# Create a new database from the backup file
docker exec -i $CONTAINER_NAME psql -U $POSTGRES_USER < $BACKUP_FILE_PATH

echo "Database '$DATABASE_NAME' created and restored."

# Restart the PostgreSQL container to apply changes
docker restart $CONTAINER_NAME

echo "PostgreSQL container restarted."
